/*!build time : 2013-10-20 6:36:08 PM*/
KISSY.add("gallery/KOnepageScroll/1.0/index",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a),b.init()}var e,f,g=b.all,h=0,i=0,j=0,k=500,l="";return a.extend(d,c,{init:function(){var b=this,c=this.get("container"),d=this.get("sectionContainer"),j=g(d),k=this.get("pagination"),m=this.get("updateURL"),n=this.get("keyboard");if(c){if(e=c,f=j,h=f.length,e.addClass("onepage-wrapper").css("position","relative"),a.each(f,function(a,b){g(a).css({position:"absolute",top:i+"%"}).addClass("section").attr("data-index",b+1),i+=100,k&&(l+="<li><a data-index='"+(b+1)+"' href='#"+(b+1)+"'></a></li>")}),this.swipeEvents().on("swipeDown",function(){this.moveUp()}).on("swipeUp",function(){this.moveDown()}),k){g("<ul class='onepage-pagination'>"+l+"</ul>").prependTo("body");var o=-1*(e.all(".onepage-pagination").height()/2);e.all(".onepage-pagintaion").css("margin-top",o+"px")}if(""!=window.location.hash&&"#1"!=window.location.hash){var p=window.location.hash.replace("#","");g(d+"[data-index='"+p+"']").addClass("active"),g("body").addClass("viewing-page-"+p),k&&g(".onepage-pagination li a[data-index='"+p+"']").addClass("active");var q=-1*100*(p-1);this.transformPage(q,p)}else g(d+"[data-index='1']").addClass("active"),g("body").addClass("viewing-page-1"),k&&g(".onepage-pagination li a[data-index='1']").addClass("active");return k&&g(".onepage-pagination li a").on("click",function(a){var c=g(a.target),e=c.attr("data-index");if(!c.hasClass("active")){var f=g(d+".active"),h=g(d+"[data-index='"+e+"']");h&&(f.removeClass("active"),h.addClass("active"),g(".onepage-pagination li a.active").removeClass("active"),g(".onepage-pagination li a[data-index='"+e+"']").addClass("active"),g("body")[0].className=g("body")[0].className.replace("/\bviewing-page-d.*?\b/g",""),g("body").addClass("viewing-page-"+h.attr("data-index")));var i=-1*100*(e-1);b.transformPage(i,e)}return m?void 0:!1}),g(document).on("mousewheel DOMMouseScroll",function(a){a.preventDefault();var c=a.originalEvent.wheelDelta||-a.originalEvent.detail;b._init_scroll(a,c)}),n&&g(document).on("keydown",function(a){var c=a.target.tagName.toLowerCase();switch(a.which){case 38:"input"!=c&&"textarea"!=c&&b.moveUp();break;case 40:"input"!=c&&"textarea"!=c&&b.moveDown();break;default:return}a.preventDefault()}),!1}},swipeEvents:function(){return e.each(function(a){function b(a){var b=a.originalEvent.touches;b&&b.length&&(d=b[0].pageX,e=b[0].pageY,f.on("touchmove",c)),a.preventDefault()}function c(a){var b=a.originalEvent.touches;if(b&&b.length){var g=d-b[0].pageX,h=e-b[0].pageY;g>=50&&f.fire("swipeLeft"),-50>=g&&f.fire("swipeRight"),h>=50&&f.fire("swipeUp"),-50>=h&&f.fire("swipeDown"),(Math.abs(g)>=50||Math.abs(h)>=50)&&f.detach("touchmove",c)}a.preventDefault()}var d,e,f=g(a);f.on("touchstart",b)})},transformPage:function(b,c){var d=this.get("animationTime"),f=this.get("easing"),h=this.get("afterMove");g(e).css({"-webkit-transform":"translate3d(0, "+b+"%, 0)","-webkit-transition":"all "+d+"ms "+f,"-moz-transform":"translate3d(0, "+b+"%, 0)","-moz-transition":"all "+d+"ms "+f,"-ms-transform":"translate3d(0, "+b+"%, 0)","-ms-transition":"all "+d+"ms "+f,transform:"translate3d(0, "+b+"%, 0)",transition:"all "+d+"ms "+f}),g(e).on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){a.isFunction(h)&&(h(c),g(e).detach("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"))})},moveDown:function(){var b,c=this.get("sectionContainer"),d=this.get("loop"),e=this.get("beforeMove"),f=this.get("pagination"),h=this.get("updateURL"),i=parseInt(g(c+".active").attr("data-index")),j=g(c+"[data-index='"+i+"']"),k=g(c+"[data-index='"+(i+1)+"']");if(k.length<1){if(1!=d)return;b=0,k=g(c+"[data-index='1']")}else b=-1*100*i;if(a.isFunction(e)&&e(j.attr("data-index")),j.removeClass("active"),k.addClass("active"),1==f&&(g(".onepage-pagination li a[data-index='"+i+"']").removeClass("active"),g(".onepage-pagination li a[data-index='"+k.attr("data-index")+"']").addClass("active")),g("body")[0].className=g("body")[0].className.replace(/\bviewing-page-\d.*?\b/g,""),g("body").addClass("viewing-page-"+k.attr("data-index")),history.replaceState&&1==h){var l=window.location.href.substr(0,window.location.href.indexOf("#"))+"#"+(i+1);history.pushState({},document.title,l)}this.transformPage(b,i)},moveUp:function(){var b,c=this.get("sectionContainer"),d=this.get("loop"),e=this.get("beforeMove"),f=this.get("pagination"),i=this.get("updateURL"),j=parseInt(g(c+".active").attr("data-index")),k=g(c+"[data-index='"+j+"']"),l=g(c+"[data-index='"+(j-1)+"']");if(l.length<1){if(1!=d)return;b=-1*100*(h-1),l=g(c+"[data-index='"+h+"']")}else b=-1*100*(l.attr("data-index")-1);if(a.isFunction(e)&&e(k.attr("data-index")),k.removeClass("active"),l.addClass("active"),1==f&&(g(".onepage-pagination li a[data-index='"+j+"']").removeClass("active"),g(".onepage-pagination li a[data-index='"+l.attr("data-index")+"']").addClass("active")),g("body")[0].className=g("body")[0].className.replace(/\bviewing-page-\d.*?\b/g,""),g("body").addClass("viewing-page-"+l.attr("data-index")),history.replaceState&&1==i){var m=window.location.href.substr(0,window.location.href.indexOf("#"))+"#"+(j-1);history.pushState({},document.title,m)}this.transformPage(b,j)},_init_scroll:function(a,b){var c=+new Date,d=this.get("animationTime");return k+d>c-j?(a.preventDefault(),void 0):(0>b?this.moveDown():this.moveUp(),j=c,void 0)}},{ATTRS:{container:{value:"",setter:function(a){return g(a)}},sectionContainer:{value:"section"},easing:{value:"ease"},animationTime:{value:1e3},pagination:{value:!0},updateURL:{value:!1},keyboard:{value:!0},beforeMove:{value:function(){}},afterMove:{value:function(){}},loop:{value:!1}}}),d},{requires:["node","base","sizzle"]});